<% 
const layout = 'layout';
const body = `
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Admin Dashboard</h1>
    <div>
        <span class="badge bg-info">${new Date().toLocaleString()}</span>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4>${stats.totalUsers}</h4>
                        <p class="mb-0">Total Users</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4>${stats.totalContent}</h4>
                        <p class="mb-0">Content Items</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-file-alt fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4>${stats.totalMedia}</h4>
                        <p class="mb-0">Media Files</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-images fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4>${stats.publishedContent}</h4>
                        <p class="mb-0">Published</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-check-circle fa-2x"></i>
                    </div>
                </div>
            </div>
            <div class="card-footer bg-transparent">
                <span class="text-white">${stats.draftContent} drafts</span>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5>Recent Content</h5>
            </div>
            <div class="card-body">
                ${recentContent.length > 0 ? `
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Type</th>
                                    <th>Author</th>
                                    <th>Status</th>
                                    <th>Modified</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${recentContent.map(content => `
                                    <tr>
                                        <td><a href="/content/${content.Slug}">${content.Title}</a></td>
                                        <td><span class="badge bg-secondary">${content.ContentType}</span></td>
                                        <td>${content.FirstName} ${content.LastName}</td>
                                        <td>
                                            ${content.Status === 'Published' ? '<span class="badge bg-success">Published</span>' : 
                                              content.Status === 'Draft' ? '<span class="badge bg-warning">Draft</span>' : 
                                              '<span class="badge bg-secondary">' + content.Status + '</span>'}
                                        </td>
                                        <td>${new Date(content.ModifiedDate).toLocaleDateString()}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                ` : '<p class="text-muted">No content available.</p>'}
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5>Recent Activity</h5>
            </div>
            <div class="card-body">
                ${recentActivity.length > 0 ? recentActivity.slice(0, 10).map(activity => `
                    <div class="d-flex mb-2">
                        <div class="me-2">
                            ${activity.Action === 'CREATE' ? '<i class="fas fa-plus-circle text-success"></i>' :
                              activity.Action === 'UPDATE' ? '<i class="fas fa-edit text-warning"></i>' :
                              activity.Action === 'DELETE' ? '<i class="fas fa-trash text-danger"></i>' :
                              activity.Action === 'LOGIN' ? '<i class="fas fa-sign-in-alt text-info"></i>' :
                              '<i class="fas fa-circle text-secondary"></i>'}
                        </div>
                        <div class="flex-grow-1">
                            <small>
                                <strong>${activity.FirstName ? activity.FirstName + ' ' + activity.LastName : 'System'}</strong>
                                ${activity.Action.toLowerCase()}
                                ${activity.EntityType ? activity.EntityType : ''}
                                <br>
                                <span class="text-muted">${new Date(activity.CreatedDate).toLocaleString()}</span>
                            </small>
                        </div>
                    </div>
                `).join('') : '<p class="text-muted">No recent activity.</p>'}
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5>Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="/admin/databaseinfo" class="btn btn-outline-primary btn-sm">Database Information</a>
                    <a href="/" class="btn btn-outline-success btn-sm">View Site</a>
                </div>
            </div>
        </div>
    </div>
</div>
`;
%>

<%- include('layout', { title, body }) %>